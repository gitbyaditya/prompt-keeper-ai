<!doctype html>
<html lang="en" x-data="promptKeeper()" x-init="loadPrompts()">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Prompt Keeper</title>
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            defer
        ></script>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <script
            src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
            defer
        ></script>
    </head>
    <body class="bg-light">
        <nav class="navbar navbar-dark bg-dark px-4">
            <span class="navbar-brand mb-0 h1">ðŸ§  Prompt Keeper</span>
            <button
                class="btn btn-primary"
                data-bs-toggle="modal"
                data-bs-target="#promptModal"
                @click="editIndex = null; resetForm()"
            >
                + Add
            </button>
        </nav>

        <div class="container py-4">
            <template x-for="(prompt, index) in prompts" :key="index">
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title" x-text="prompt.title"></h5>
                        <p class="card-text" x-text="prompt.content"></p>
                        <button
                            class="btn btn-sm btn-outline-secondary me-2"
                            @click="openEdit(index)"
                        >
                            Edit
                        </button>
                        <button
                            class="btn btn-sm btn-outline-danger"
                            @click="deletePrompt(index)"
                        >
                            Delete
                        </button>
                    </div>
                </div>
            </template>
        </div>

        <!-- Modal -->
        <div
            class="modal fade"
            id="promptModal"
            tabindex="-1"
            aria-hidden="true"
        >
            <div class="modal-dialog">
                <form class="modal-content" @submit.prevent="savePrompt">
                    <div class="modal-header">
                        <h5
                            class="modal-title"
                            x-text="editIndex === null ? 'Add Prompt' : 'Edit Prompt'"
                        ></h5>
                        <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                            aria-label="Close"
                            @click="resetForm()"
                        ></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Title</label>
                            <input
                                type="text"
                                class="form-control"
                                x-model="form.title"
                                required
                            />
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Prompt</label>
                            <textarea
                                class="form-control"
                                rows="4"
                                x-model="form.content"
                                required
                            ></textarea>
                        </div>
                        <!-- ðŸ·ï¸ Tags input to be added in Phase 2 -->
                    </div>
                    <div class="modal-footer">
                        <button
                            type="submit"
                            class="btn btn-success"
                            data-bs-dismiss="modal"
                        >
                            Save
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <script>
            function promptKeeper() {
                return {
                    prompts: [],
                    form: { title: "", content: "" },
                    editIndex: null,

                    loadPrompts() {
                        const saved = localStorage.getItem("prompts");
                        this.prompts = saved ? JSON.parse(saved) : [];
                    },
                    savePrompt() {
                        if (this.editIndex === null) {
                            this.prompts.push({ ...this.form });
                        } else {
                            this.prompts[this.editIndex] = { ...this.form };
                        }
                        localStorage.setItem(
                            "prompts",
                            JSON.stringify(this.prompts),
                        );
                        this.resetForm();
                    },
                    deletePrompt(index) {
                        this.prompts.splice(index, 1);
                        localStorage.setItem(
                            "prompts",
                            JSON.stringify(this.prompts),
                        );
                    },
                    openEdit(index) {
                        this.editIndex = index;
                        this.form = { ...this.prompts[index] };
                        new bootstrap.Modal(
                            document.getElementById("promptModal"),
                        ).show();
                    },
                    resetForm() {
                        this.form = { title: "", content: "" };
                    },
                };
            }
        </script>
    </body>
</html>
